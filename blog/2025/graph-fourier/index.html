<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Spatial Omics I: Transcriptional Signals Over Tissue Domains | Kamal Maher </title> <meta name="author" content="Kamal Maher"> <meta name="description" content="An introduction to graph signal processing in spatial omics data"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%AB%A7&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://kmaherx.github.io/blog/2025/graph-fourier/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/img-comparison-slider@8.0.6/dist/styles.min.css" integrity="sha256-3qTIuuUWIFnnU3LpQMjqiXc0p09rvd0dmj+WkpQXSR8=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11.0.5/swiper-bundle.min.css" integrity="sha256-yUoNxsvX+Vo8Trj3lZ/Y5ZBf8HlBFsB6Xwm7rH75/9E=" crossorigin="anonymous"> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Spatial Omics I: Transcriptional Signals Over Tissue Domains
",
            "description": "An introduction to graph signal processing in spatial omics data",
            "published": "May 14, 2025",
            "authors": [
              
              {
                "author": "Kamal Maher",
                "authorURL": "",
                "affiliations": [
                  {
                    "name": "MIT, Broad Institute",
                    "url": ""
                  }
                ]
              }
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Kamal</span> Maher </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Spatial Omics I: Transcriptional Signals Over Tissue Domains </h1> <p>An introduction to graph signal processing in spatial omics data</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#introduction">Introduction</a> </div> <ul> <li> <a href="#tissues">Tissues</a> </li> <li> <a href="#domains-and-signals">Domains and signals</a> </li> <li> <a href="#signal-processing">Signal processing</a> </li> <li> <a href="#overview">Overview</a> </li> </ul> <div> <a href="#simulation">Simulation</a> </div> <ul> <li> <a href="#construction">Construction</a> </li> <li> <a href="#the-tissue-domain">The tissue domain</a> </li> <li> <a href="#transcriptional-signals">Transcriptional signals</a> </li> <li> <a href="#frequencies">Frequencies</a> </li> <li> <a href="#spectra">Spectra</a> </li> <li> <a href="#filtering">Filtering</a> </li> </ul> <div> <a href="#real-data">Real data</a> </div> <ul> <li> <a href="#frequencies">Frequencies</a> </li> <li> <a href="#filtering">Filtering</a> </li> <li> <a href="#multiple-samples">Multiple samples</a> </li> </ul> <div> <a href="#conclusion">Conclusion</a> </div> </nav> </d-contents> <style>.slider-with-shadows{--default-handle-shadow:0 0 5px rgba(0,0,0,1);--divider-shadow:0 0 5px rgba(0,0,0,0.5)}</style> <h2 id="introduction">Introduction</h2> <p>Here, we will build an intuition for how to describe frequencies over graphs in terms of gene expression over biological tissues. We’ll assume familiarity with linear algebra. We will use simulations to</p> <h3 id="tissues">Tissues</h3> <p>Cells are important Have different <a href="https://www.cell.com/cell-systems/fulltext/S2405-4712(18)30482-4" rel="external nofollow noopener" target="_blank">roles in the tissue that can largely be described by their molecular patterns</a>. Such “types” catalogued by efforts such as the human cell atlas.</p> <p>But cells don’t act independently. If you look at an organism, you’ll notice a few things. First, it’s an organism; there’s some sense that it’s a discrete collection of cells all working together. Second, you might notice that cells within a given organism are further organized into discrete multicellular structures, such as organs or the anatomical regions within them. Third, and perhaps most importantly, the very formation and function of such structures is driven by interactions between their constituent cells. Altogether, it is critical to look beyond cells in isolation to recognize their</p> <p>We can break these patterns down into two broad categories. Multicellular regions Intercellular interactions</p> <p>Both of these patterns are inherently spatial. Regions Interactions Thus, spatial omics technologies enable us to measure these patterns.</p> <p>Given the importance of this data, we should have a concrete way to quantitatively describe and analyze them. However, the current landscape of computational methods for spatial omics data is deeply fragmented. It largely consists of complicated methods based on graph neural networks and probabilistic models, and it lacks a fundamental basis for relating these approaches or even defining the core features one would like to quantify.</p> <p>In this series of posts, we will derive such a basis. The tools we will use are borrowed from the vast field of signal processing.</p> <h3 id="domains-and-signals">Domains and signals</h3> <p>Sound (Continuous, 1D)</p> <p>Images (discrete, 2D)</p> <p>Graphs? (discrete, but what dimension? will come back to this)</p> <h3 id="signal-processing">Signal processing</h3> <p>Sound (music, bass/mids/treble)</p> <p>Images (denoising by removing highs)</p> <h3 id="overview">Overview</h3> <p>Simulations then real data</p> <p>This isn’t a new idea. Fundamentals of GSP. GNNs based on GSP, just overshadow the basics. But when we thoroughly explore the basics, we can find previously overlooked ideas. This chapter will only cover the basics, with applications covered in future posts.</p> <hr> <h2 id="simulation">Simulation</h2> <p>We’ll first demonstrate the fundamental concepts in a simple simulation. This will allow us to build up some intuition before approaching data gathered from real tissues, which is full of both technical artifacts and true biological complexity.</p> <h3 id="construction">Construction</h3> <p>Take the brain as inspiration. We’ll start off by creating a simple tissue made up of $n=2000$ cells randomly scattered throughout a unit circle. One should ask why a circle and not a sphere. It’s because, while tissues are 3D objects, we tend to measure them in 2D slices. That being said, everything presented in this series of posts can be generalized to data in arbitrary dimensions, including 3D.</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/tissue_domain_nozoom.png" alt="" style="width:30%; display: block; margin: 0 auto;"> <figcaption><strong>Figure 1:</strong> Simulation of a simple, circular tissue. </figcaption> </figure> <p>Some spatial cells that form layers (neurons), some non-spatial cells scattered throughout (glia, for the most part).</p> <p>Ground truth region patterns. Add different noise patterns to make multiple gene markers for each ground truth pattern. One marker per pattern shown in Figure &lt;&gt;.</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/simulation_lows.png" alt="" style="width:100%; display: block; margin: 0 auto;"> <figcaption><strong>Figure 1:</strong> Schematic for simulating multicellular region patterns. </figcaption> </figure> <p>On the other hand, spatial patterns also arise from interactions between cells. For instance, two <em>neighboring</em> cells might interact when <em>one</em> expresses a ligand and <em>the other</em> expresses the corresponding receptor. This would produce a mutually exclusive pattern between two genes: one associated with the ligand and the other associated with the receptor. We can simulate this by</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/simulation_highs.png" alt="" style="width:100%; display: block; margin: 0 auto;"> <figcaption><strong>Figure 1:</strong> Schematic for simulating intercellular interaction patterns. </figcaption> </figure> <p>Note that this simulation is not nearly as complex as a real biological tissue or the data measured from one. That being said, it should at least provide a simple playground in which we can explore some fundamental quantitative concepts that we will later apply to real data.</p> <p>That being said, let’s start exploring these quantitative fundamentals.</p> <h3 id="the-tissue-domain">The tissue domain</h3> <p>We can think of the tissue domain as an undirected graph over $n$ nodes, each of which represents a cell. We could construct this graph in many ways, including connecting each cell to its k nearest physical neighbors. Personally, I prefer using a Delaunay triangulation, as it creates a mesh that’s embeddable in 2D, which respects my own visual intuition. If you’re optimistic, you might also believe that it <a href="https://pubmed.ncbi.nlm.nih.gov/20082148/" rel="external nofollow noopener" target="_blank">captures the mechanical forces present in biological tissues</a>. After performing a Delaunay triangulation, we can zoom in to see that the cells are indeed connected to their spatial neighbors to form a 2D mesh. These connections define the space within which we can hop from cell to cell.</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/tissue_domain.png" alt="" style="width:50%; display: block; margin: 0 auto;"> <figcaption><strong>Figure 1:</strong> Cells arranged in a spatial graph to form a tissue domain. </figcaption> </figure> <p>Now let’s define the key mathematical objects associated with this tissue domain. Our graph can be represented by the symmetric adjacency matrix</p> \[\mathbf{A} \in \{0,1\}^{n \times n}.\] <p>Each entry \(\mathbf{A}_{ij}\) is either $1$, which represents two cells that are spatially adjacent, or $0$, which represents two cells that are not adjacent. While we could weight these edges based on physical distances between cells, we will instead stick to simple binary edges for simplicity. We also will not consider self loops: \(\mathbf{A}_{ii} = 0\). The number of neighbors for cell $i$ – the “degree” – is given by \(d_i = \sum_j \mathbf{A}_{ij}\). These values are often consolidated into the diagonal degree matrix</p> \[% \mathbf{D} = \operatorname{diag}(d_1, ..., d_n) = \mathbf{D} = \begin{bmatrix} d_{1} &amp; &amp; \\ &amp; \ddots &amp; \\ &amp; &amp; d_{n} \end{bmatrix} \in \mathbb{R}^{n \times n}.\] <p>Finally, we can introduce the Laplacian matrix</p> \[\mathbf{L} = \mathbf{D} - \mathbf{A}\] <p>For convenience, we will instead consider the edge-normalized Laplacian $\mathbf{L} = \mathbf{I} - \mathbf{D}^{-\frac{1}{2}} \mathbf{A} \mathbf{D}^{-\frac{1}{2}}$, since it’s eigenvalues have some nice properties that we will leverage later. We can think of the Laplacian as a slight modification of the adjacency matrix that’s more closely related to the notion of frequency, as we will see below.</p> <p>Note that the order of cells in these matrices is arbitrary. It doesn’t matter so long as it is consistent across all related vectors and matrices.</p> <p>Now that we have a simulated tissue domain, we can create gene expression signals over it.</p> <h3 id="transcriptional-signals">Transcriptional signals</h3> <p>A signal is a vector of values associated with each node in our graph. In our case, we are interested in the amount that a given gene is expressed within each cell of a tissue. We can collect all of these values into a list, yielding the vector $\mathbf{x} \in \mathbb{R}^n$, where $\mathbf{x}_i$ is the amount of gene $x$ expressed in cell $i$. We can further collect all of these gene signals into the matrix</p> \[\mathbf{X} = [\mathbf{x}_1 | ... | \mathbf{x}_g] \in \mathbb{R}^{n \times g},\] <p>where $g$ is the number of genes measured. This is the “cell-by-gene matrix”, the <a href="https://cellxgene.cziscience.com/" rel="external nofollow noopener" target="_blank">fundamental data structure underlying all of single-cell omics</a>.</p> <p>Now that we’ve quantitatively defined both our domain and our signals, our challenge is to combine them.</p> <h3 id="frequencies">Frequencies</h3> <p>While it’s often said that spatial data offers more information than dissociated single-cell data, we might be better served by the intuition that spatial coordinates enable us to strategically <em>remove</em> information. Namely, it allows us to focus on gene expression over particular length scales of interest, disentangling the mess of information into more interpretable components. But how can we isolate a given length scale? The first step is defining what a length scale is in the first place.</p> <p>Take music, for instance, in which the different frequency ranges of bass, mids, and trebles define different <em>time</em> scales along which a sound can vary. Similarly, our notion of <em>length</em> scale can be made quantitatively rigorous in terms of <em>spatial</em> frequencies. While a straightforward extension of this concept to two dimensions captures spatial frequencies in an image, it’s not so straightforward to extend to graphs due to their irregular topology. Thus, we have to do a little leg work to extend this concept to our tissue domain.</p> <p>We can start by slowly deriving a definition of frequency in a graph setting. Consider a hypothetical signal $\mathbf{v}$ over the tissue. The notion of frequency is simply “how much does the signal tend to change as I take a step in the domain?” Taking a step in our tissue domain corresponds to moving between neighboring cells $i$ and $j$. The change in our signal as we take this step is thus given by $\mathbf{v}_i - \mathbf{v}_j$. However, we don’t really care about the sign, so we can just square it to get $(\mathbf{v}_i - \mathbf{v}_j)^2$. This is just one step, and we care about how the signal tends to change with steps throughout the whole tissue in general. To capture this tendency, we can simply sum over all pairs of neighboring cells, yielding our final definition of frequency</p> <p>\begin{equation} \label{eq:freqdef} \lambda = \sum_{ij} \mathbf{A}_{ij} (\mathbf{v}_i - \mathbf{v}_j)^2 \end{equation}</p> <p>Note that because we are summing over <em>all</em> possible pairs of cells $i$ and $j$, we have to multiply each one by $\mathbf{A}_{ij}$ so that we only consider <em>neighboring</em> pairs.</p> <p>This definition of frequency for a given signal might make sense, but what we are really looking for is an ideal <em>set</em> of signals that represent <em>all possible frequencies</em>, much as time scales are given by sine waves of all possible frequencies. It turns out that, because our tissue domain is finite and discrete, we can actually solve for a finite set of all possible frequencies, and it ends up being a basis in the linear algebraic sense.</p> <p>To see this, let’s first rewrite eq. \eqref{eq:freqdef} as a “<a href="https://gregorygundersen.com/blog/2022/02/27/positive-definite/" rel="external nofollow noopener" target="_blank">quadratic form</a>”, which works in our favor by getting us a step further into the realm of linear algebra:</p> \[\lambda = \mathbf{v}^{\top} \mathbf{L} \mathbf{v}.\] <details><summary>How exactly can we show that?</summary> <p>Eq. \eqref{eq:freqdef} can be converted into a quadratic form via a process reminiscent of annealing. First, we heat it up by factoring the $\mathbf{v}$ terms to get</p> \[\sum_{i,j}\mathbf{A}_{ij}( v_i v_i + v_j v_j - v_i v_j - v_j v_i ).\] <p>We can then begin to cool it down by combining positive and negative terms, respectively, yielding</p> \[2 \sum_{i,j}\mathbf{A}_{ij} v_i v_i - 2 \sum_{i,j}\mathbf{A}_{ij} v_i v_j.\] <p>Note that, for a fixed row $i$, the left-hand term corresponds to summing $v_i v_i$ together $d_i$ times, where $d_i$ is the sum of the $i$th row of $\mathbf{A}$. Thus, one could equivalently express the left-hand term as</p> \[2 \sum_{i}\mathbf{D}_{ii} v_i v_i.\] <p>Now both the left and right terms themselves correspond to quadratic forms, yielding</p> \[2 \mathbf{v}^{\top} \mathbf{D} \mathbf{v} - 2 \mathbf{v}^{\top} \mathbf{A} \mathbf{v}.\] <p>Further simplifying, we have</p> \[2 \mathbf{v}^{\top} (\mathbf{D}-\mathbf{A}) \mathbf{v}\] <p>and further</p> \[2 \mathbf{v}^{\top} \mathbf{L} \mathbf{v}.\] <p>The factor of two arises from double counting each edge, which corresponds to a directed edge in each direction. Because we tend to think of each undirected edge as only a single edge going both ways, folks tend to omit this factor, yielding the final expression</p> \[\mathbf{v}^{\top} \mathbf{L} \mathbf{v}.\] </details> <p>We can further rearrange this expression into an eigenvalue problem:</p> \[\lambda \mathbf{v} = \mathbf{L} \mathbf{v}.\] <details><summary>How exactly can we show that?</summary> <p>We should probably normalize $\lambda = \mathbf{v}^{\top} \mathbf{L} \mathbf{v}$ to guarantee that the overall expression strength doesn’t influence the frequency value. After all, we really only care about the relative spatial distribution of the signal, not its overall magnitude. We can do this normalization by dividing the magnitude out:</p> \[\lambda = \frac{\mathbf{v}^{\top} \mathbf{L} \mathbf{v}}{\mathbf{v}^{\top} \mathbf{v}}.\] <p>Note that this is a Rayleigh quotient, which is intimately tied to eigendecomposition. With a bit of rearranging, we end up with an eigenvalue problem:</p> \[\begin{align} &amp; \lambda = {\frac{\mathbf{v}^{\top} \mathbf{L} \mathbf{v}}{\mathbf{v}^{\top} \mathbf{v}}} \nonumber \\ &amp;\rightarrow \lambda \mathbf{v}^{\top} \mathbf{v} = \mathbf{v}^{\top} \mathbf{L} \mathbf{v} \nonumber \\ &amp;\rightarrow \lambda \mathbf{v} = \mathbf{L} \mathbf{v}. \nonumber \end{align}\] </details> <p>This is a critical insight because $\mathbf{L}$ is symmetric positive semidefinite (PSD) and thus has an eigenbasis of eigenvectors with real, nonnegative eigenvalues. This eigenbasis is given by the matrix</p> \[\mathbf{V} = [\mathbf{v}_1 |...| \mathbf{v}_n] \in \mathbb{R}^{n \times n}.\] <p>Let’s plug all of this terminology into our context of interest by realizing two key points. <strong>First</strong> of all, we found that there exists a finite set of ideal signals ${\mathbf{v}_1, …, \mathbf{v}_n}$ that represent “all possible frequencies” – and thus all possible length scales – over our tissue domain. This is great because it means we can rigorously talk about any length scale of interest. Below are some examples plotted in the tissue to illustrate this intuition. Note that no gene expression information went into calculating these frequencies; rather, they are an abstract representation of variation on different length scales.</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/frequencies.png" alt="" style="width:100%; display: block; margin: 0 auto;"> <figcaption><strong>Figure 3:</strong> Examples of different frequencies over the tissue domain. </figcaption> </figure> <details><summary>Why do highs appear constrained to one part of the tissue?</summary> <p>When taking a look at $\mathbf{v}_{301}$, the fluctuations appear constrained a bit toward the lower left of the tissue. I’ll just provide some intuition for this observation.</p> <p>This asymmetry (or “localization”) is due to the irregularity of the graph domain. Consider the time and image domains in which you always have the same choice of how to move no matter where you are in the tissue (apart from the boundaries). Graphs generally lack this regularity due to the variation in degree across different nodes. At one node, you may have four options of where to move next. At the next node, you may have seven options.</p> <p>Consequences of this irregularity arise when considering the maximum frequency patterns over the graph, which we can think of as</p> \[\mathbf{v}_{max} = \operatorname{argmax}_{\mathbf{v}} \frac{\mathbf{v}^{\top} \mathbf{L} \mathbf{v}}{\mathbf{v}^{\top} \mathbf{v}}\] <p>Because of its normalization, \(\mathbf{v}_{max}\) should ideally be concentrated on a single node and its immediate neighbors. Furthermore, it should specifically be concentrated on the node with the most neighbors, i.e. the highest degree. Indeed, when visualizing $\mathbf{v}_{1994}$, we can see that it’s concentrated on nodes with relatively high degrees (compared to the <a href="https://en.wikipedia.org/wiki/Delaunay_triangulation#Properties" rel="external nofollow noopener" target="_blank">degree of six we’d expect here</a>).</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/freq_localization.png" alt="" style="width:70%; display: block; margin: 0 auto;"> </figure> <p>Interestingly, this phenomenon has deep connections to the <a href="https://arxiv.org/abs/2306.15810" rel="external nofollow noopener" target="_blank">Heisenberg uncertainty principle</a>.</p> </details> <p>The <strong>second</strong> key point is that this set of ideal frequencies forms a basis in the linear algebraic sense. This means that when we do measure a gene expression signal, we can project it into this “frequency space” to quantify its prevalence on each length scale.</p> <p>That’s what we’ll do next.</p> <h3 id="spectra">Spectra</h3> <p>We can think of projecting a given gene expression signal $\mathbf{x}$ into frequency space as comparing it to each frequency $\mathbf{v}_i$. For a single frequency, this is given by the inner product $\mathbf{v}_i^{\top} \mathbf{x} \in \mathbb{R}$. For all frequencies, this is given by the matrix product $\mathbf{s} = \mathbf{V}^{\top} \mathbf{x} \in \mathbb{R}^n$, where the output is the similarity of $\mathbf{x}$ to each of $\mathbf{v}_1, …, \mathbf{v}_n$. The vector $\mathbf{s}$ is often referred to as the signal’s “spectrum”. An analogy I tend to think of is that the original gene expression signal over the tissue is like a dish you might cook. You could always think of that dish in terms of its corresponding <em>recipe</em>, i.e. the amounts of each ingredient necessary to construct it. In this case, the recipe is the spectrum, and the ingredients are the frequencies. This process of representing a signal in terms of its spectrum is known as the <a href="https://betterexplained.com/articles/an-interactive-guide-to-the-fourier-transform/" rel="external nofollow noopener" target="_blank">Fourier transform</a>.</p> <p>Let’s visualize one of our region marker genes’ spectra as an example.</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/spectra.png" alt="" style="width:100%; display: block; margin: 0 auto;"> <figcaption><strong>Figure 3:</strong> An example gene expression signal in tissue space and in frequency space. </figcaption> </figure> <p>By design, this gene forms a large-scale pattern over the tissue. As a result, its spectrum shows a spike in the low frequencies. Thus, we now have a way of calculating the freuqency contents (or length scale contents) of a given gene expression signal within a tissue.</p> <p>Note that, while the spectrum shown above is entirely positive, spectra generally do contain negative values. We just chose to take the absolute value of the spectrum to better convey the intuition of how prevalent a signal is over a given length scale, i.e. omitting its sign. Additionally, we chose not to visualize the first value $s_1$, as it just corresponds a translation factor.</p> <details><summary>Why is $s_1$ is just a translation factor?</summary> <p>What I mean by a “translation factor” here is just an “intercept” or “bias” term that is added to all cells to shift their expression values up/down by the same amount. Thus, we can think of it as some vector with entries that are all the same value, i.e. a scaled version of the ones vector $\mathbf{1} = [1, …, 1]^{\top}$. We are assuming that it corresponds to the first eigenvalue of $\mathbf{L}$, so let’s first confirm that it’s an eigenvector by multiplying them. Notice that</p> \[\mathbf{L} \mathbf{1} = 0.\] <p>This follows from how we’ve constructed the Laplacian; the degree of each node is on the diagonal and the instances of each neighbor on the off diagonal sum up to an amount of equal but opposite sign. Thus, the sum over each row, as calculated above by multiplying with the ones vector, is simply $0$. We can write this out in the form of an eigenvalue problem:</p> \[\mathbf{L} \mathbf{1} = \lambda \mathbf{1} = 0.\] <p>This holds true for $\lambda = 0$, which is the minimal eigenvalue (i.e. “first” when sorted) since $\mathbf{L}$ is PSD. So the first eigenvalue corresponds to the all ones vector, i.e. the uniform shift in all the values over the graph that we wanted to get rid of.</p> <p>Note that this generalizes to any vector with all equal entries because we could just express it as the ones vector scaled by some scalar $p$, which yields the same result:</p> \[p \mathbf{L} \mathbf{1} = p \lambda \mathbf{1} = 0.\] </details> <p>There are many interesting things we could do with spectra. You might think of comparing gene expression signals based on their spectra, perhaps to find classes of spectral patterns (i.e. biologically-relevant length scales) using PCA or NMF. However, there are also many interesting issues with these ideas. For instance, a spectrum has the same dimension as its corresponding tissue. This makes comparison across different tissues difficult because the dimensions of spectra likely differ. We’ll leave these pitfalls and opportunities to a future blog post.</p> <p>For now, let’s instead focus on modifying these spectra, i.e. performing filtering.</p> <h3 id="filtering">Filtering</h3> <p>In the language of the above analogy, modifying spectra allows us to ask “what happens to the dish when I remove this ingredient?” More explicitly, it allows us to modify the frequency contents of a given signal and see how it looks in the tissue. We can think of this process as two steps.</p> <p>The <strong>first</strong> step is to modify the signal’s spectrum. We could do this in a crude way by setting entries of the spectrum to zero to get rid of them entirely. However, more generally, we could <em>weight</em> them. For instance, we could define some function – or “kernel” – over frequency values that preferentially weights lows stronger than highs. This is known as a “low-pass” kernel. One popular example of such a function is the diffusion kernel $f(\lambda) = e^{-\tau \lambda}$, where $\tau$ is some parameter that adjusts how “quick” diffusion occurs. This kernel is indeed low-pass, as it is a monotonically decreasing function of frequency. (The intuition of diffusion will likely become clearer once we see the result of this modification in the tissue.) By pointwise multiplying this kernel with the gene expression spectrum from earlier, we end up with a modified spectrum where the lows are maintained and the highs are diminished.</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/lowpass_spectra.png" alt="" style="width:100%; display: block; margin: 0 auto;"> <figcaption><strong>Figure 3:</strong> A gene expression signal low-pass filtered in frequency space. </figcaption> </figure> <p>Now let’s represent this mathematically. Pointwise multiplication of two vectors can be represented by turning one of them into a diagonal matrix and then multiplying. Let’s do this with the kernel. We can first arrange all of the frequency values into a diagonal matrix $\mathbf{\Lambda}$. Applying the kernel function to each of the values is the same as applying it to the whole matrix, i.e. $f(\mathbf{\Lambda})$. Multiplication of this diagonal kernel matrix with the spectrum is then given by $f(\mathbf{\Lambda}) \mathbf{V}^{\top} \mathbf{x} \in \mathbb{R}^n$. Altogether, this equation describes modification of the gene’s spectrum. While it might look a little ugly in it’s current form, it’s nice to keep it this way for later; it’ll allow us to see a neat simplification in a moment.</p> <p>The <strong>second</strong> step is to project the modified spectrum back into the tissue to visualize the result. We can do this by multiplying by the inverse of the frequency basis, i.e. $(\mathbf{V}^{\top})^{-1}$. However, because $\mathbf{V}$ is an <a href="https://gregorygundersen.com/blog/2018/10/24/matrices/" rel="external nofollow noopener" target="_blank">orthogonal matrix</a>, its inverse is just its transpose: $(\mathbf{V}^{\top})^{-1} = \mathbf{V}$. Thus, we have the full filtering equation</p> <p>\begin{equation} \label{eq:filterdef} \mathbf{\bar x} = \mathbf{V} f(\mathbf{\Lambda}) \mathbf{V}^{\top} \mathbf{x}, \end{equation}</p> <p>where $\mathbf{\bar x}$ is the filtered version of $\mathbf{x}$.</p> <details><summary>Is the bar notation standard?</summary> <p>No. I just like it because it reminds me that the result is smooth, and the bar is a smooth pattern from left to right.</p> </details> <p>We can visualize the result of this process below. Use the slider to visualize the signal before filtering (left) and after filtering (right).</p> <div style="width: 50%; max-width: 768px; margin: 0 auto;"> <img-comparison-slider class="slider-with-shadows"> <figure slot="first"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_before_filtering-480.webp 480w,/assets/figures/fourier/tissue_before_filtering-800.webp 800w,/assets/figures/fourier/tissue_before_filtering-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/figures/fourier/tissue_before_filtering.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <figure slot="second"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_after_lowpass-480.webp 480w,/assets/figures/fourier/tissue_after_lowpass-800.webp 800w,/assets/figures/fourier/tissue_after_lowpass-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/figures/fourier/tissue_after_lowpass.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </img-comparison-slider> </div> <figcaption><strong>Figure 1:</strong> Comparison of a gene expression signal before (left) and after (right) low-pass filtering. </figcaption> <p><br></p> <p>This filter appears to have blurred the underlying gene expression signal. That’s exactly what we expect given that blurring corresponds to getting rid of small-scale fluctuations. Some might think of this as <a href="https://genomemedicine.biomedcentral.com/articles/10.1186/s13073-024-01283-x" rel="external nofollow noopener" target="_blank">denoising</a>, which makes sense in the context of images. However, in a later post I’ll argue that high frequencies are not noise in the context of tissues.</p> <p>Using a final bit of math, let’s finish interpreting our filtering function, which is currently a bit lengthy. If you stare at eq. \eqref{eq:filterdef} long enough, you might notice that it looks a lot like the <a href="https://intuitive-math.club/linear-algebra/eigenbasis/" rel="external nofollow noopener" target="_blank">diagonalized</a> form of the Laplacian</p> \[\mathbf{L} = \mathbf{V} \mathbf{\Lambda} \mathbf{V}^{\top},\] <p>where $\mathbf{\Lambda}$ is the diagonal matrix of eigenvalues and $\mathbf{V}$ is the matrix of corresponding eigenvectors. The only difference is that we applied a function to each of the eigenvalues, i.e. $f(\mathbf{\Lambda})$. Interestingly, for any (analytic) function $h(\lambda)$, we have</p> \[\mathbf{V} h(\mathbf{\Lambda}) \mathbf{V}^{\top} = h(\mathbf{V} \mathbf{\Lambda} \mathbf{V}^{\top}) = h(\mathbf{L}).\] <details><summary>Why “analytic” functions?</summary> <p>Functions of matrices are often defined in terms of series, <a href="https://sassafras13.github.io/MatrixExps/" rel="external nofollow noopener" target="_blank">e.g. the exponential function</a>. A function that can be described in this way is referred to as “<a href="https://en.wikipedia.org/wiki/Analytic_function#Definitions" rel="external nofollow noopener" target="_blank">analytic</a>”. Thus, for our kernel function to apply to matrix arguments, it must be analytic.</p> </details> <p>Thus, any (analytic) filter can be expressed as a function of the Laplacian. This is cool for a few reasons. First of all, it’s pretty. Second, it will actually help us interpret equations that emerge en route to deriving interactions in a future post. Third, it gives us a concise notation to work with for the remainder of this post; given a kernel such as the one above, $f$, filtering can simply be expressed as</p> \[\mathbf{\bar x} = f(\mathbf{L}) \mathbf{x}.\] <p>While the above filtering example was low-pass, we could instead perform high-pass filtering. First, let’s define a kernel that preferentially weights highs. We can use the square-root kernel $g(\lambda) = \lambda^{\frac{1}{2}}$, as it is monotonically increasing with frequency. (This will be an important kernel for defining interactions in a later post.) Using the concise notation from above, we can apply this filter to calculate the high-pass filtered signal</p> \[\mathbf{\hat x} = g(\mathbf{\Lambda}) \mathbf{x}.\] <details><summary>Is the hat notation standard?</summary> <p>No. I just like it because it reminds me that the result is not smooth, and the hat is not a smooth pattern from left to right.</p> </details> <figure style="text-align: center;"> <img src="/assets/figures/fourier/highpass_spectra.png" alt="" style="width:100%; display: block; margin: 0 auto;"> <figcaption><strong>Figure 3:</strong> A gene expression signal high-pass filtered in frequency space. </figcaption> </figure> <p>In contrast to low-pass filtering, we can see in the modified spectrum that the high-pass kernel emphasizes the higher frequency components of our signal. But what does this look like when visualized in the tissue?</p> <div style="width: 50%; max-width: 768px; margin: 0 auto;"> <img-comparison-slider class="slider-with-shadows"> <figure slot="first"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_before_filtering-480.webp 480w,/assets/figures/fourier/tissue_before_filtering-800.webp 800w,/assets/figures/fourier/tissue_before_filtering-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/figures/fourier/tissue_before_filtering.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <figure slot="second"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_after_highpass-480.webp 480w,/assets/figures/fourier/tissue_after_highpass-800.webp 800w,/assets/figures/fourier/tissue_after_highpass-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/figures/fourier/tissue_after_highpass.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </img-comparison-slider> </div> <figcaption><strong>Figure 1:</strong> Comparison of a gene expression signal before (left) and after (right) high-pass filtering. </figcaption> <p><br></p> <p>It appears that the “roughness” of our signal is preserved, and everything else is washed away. Cells with large differences with their neighbors in the original signal maintain their differences after filtering, ending up with extremal values. On the other hand, cells with little differences with their neighbors end up with values in the middle after filtering. Thus, <em>high</em>-pass filtering appears to emphasize <em>differences</em> in gene expression between neighboring cells, unlike the <em>similarities</em> highlighted by <em>low</em>-pass filtering.</p> <p>Despite our analytical treatment of filtering, explicit eigendecomposition of the Laplacian is prohibitive for tissues (graphs) with greater than approximately $n=20000$ cells (nodes). For that reason, filtering is often calculated using <a href="https://arxiv.org/abs/0912.3848" rel="external nofollow noopener" target="_blank">wavelet approximations</a>. The <em>de facto</em> package for performing this analysis is <a href="https://pygsp.readthedocs.io/en/stable/" rel="external nofollow noopener" target="_blank">PyGSP</a>, and that’s what we will use for all real biological datasets going forward.</p> <hr> <h2 id="real-data">Real data</h2> <p>Next, we’ll use <a href="https://www.nature.com/articles/s41586-021-03705-x" rel="external nofollow noopener" target="_blank">real data from the mouse brain</a>.</p> <h3 id="frequencies-1">Frequencies</h3> <p>First, the domain</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/tissue_domain_mop.png" alt="" style="width:70%; display: block; margin: 0 auto;"> <figcaption><strong>Figure 3:</strong> A tissue domain calculated from real mouse brain data. </figcaption> </figure> <p>Then the frequencies</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/frequencies_mop.png" alt="" style="width:100%; display: block; margin: 0 auto;"> <figcaption><strong>Figure 3:</strong> Example frequencies over the mouse brain tissue domain. </figcaption> </figure> <p>Then the spectrum of <em>Cux2</em>, a neocortical layer marker gene.</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/spectra_mop.png" alt="" style="width:100%; display: block; margin: 0 auto;"> <figcaption><strong>Figure 3:</strong> An example gene expression signal in tissue space and in frequency space. </figcaption> </figure> <h3 id="filtering-1">Filtering</h3> <p>First, low-pass</p> <div style="width: 50%; max-width: 768px; margin: 0 auto;"> <img-comparison-slider class="slider-with-shadows"> <figure slot="first"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_before_filtering_mop-480.webp 480w,/assets/figures/fourier/tissue_before_filtering_mop-800.webp 800w,/assets/figures/fourier/tissue_before_filtering_mop-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/figures/fourier/tissue_before_filtering_mop.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <figure slot="second"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_after_lowpass_mop-480.webp 480w,/assets/figures/fourier/tissue_after_lowpass_mop-800.webp 800w,/assets/figures/fourier/tissue_after_lowpass_mop-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/figures/fourier/tissue_after_lowpass_mop.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </img-comparison-slider> </div> <figcaption><strong>Figure 1:</strong> Comparison of a gene expression signal before (left) and after (right) low-pass filtering. </figcaption> <p><br></p> <p>Then high-pass</p> <div style="width: 50%; max-width: 768px; margin: 0 auto;"> <img-comparison-slider class="slider-with-shadows"> <figure slot="first"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_before_filtering_mop-480.webp 480w,/assets/figures/fourier/tissue_before_filtering_mop-800.webp 800w,/assets/figures/fourier/tissue_before_filtering_mop-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/figures/fourier/tissue_before_filtering_mop.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <figure slot="second"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_after_highpass_mop-480.webp 480w,/assets/figures/fourier/tissue_after_highpass_mop-800.webp 800w,/assets/figures/fourier/tissue_after_highpass_mop-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/figures/fourier/tissue_after_highpass_mop.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </img-comparison-slider> </div> <figcaption><strong>Figure 1:</strong> Comparison of a gene expression signal before (left) and after (right) high-pass filtering. </figcaption> <p><br></p> <h3 id="multiple-samples">Multiple samples</h3> <p>Now on multiple slices. The exact values differ based on the exact graph structure, but the meaning of the values is shared. Lower values indicate lower frequencies, etc. The distribution of frequency values for a given graph really just reflects the degree distribution. Because cells are largely uniformly scattered throughout a given slice, these distributions are similar across slices. Thus, we can compare frequencies across samples, and the meaning of a given kernel is conserved. One could come up with ways to overcome the difference in dimensions to compare spectral patterns across datasets, but that’s a topic we’ll leave for another post.</p> <p>In parallel Approximation, PyGSP, Hammond</p> <p>To keep things brief, we’ll just look at the low-pass results.</p> <div style="width: 100%; max-width: 768px; margin: 0 auto;"> <img-comparison-slider class="slider-with-shadows"> <figure slot="first"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_before_filtering_mop_all-480.webp 480w,/assets/figures/fourier/tissue_before_filtering_mop_all-800.webp 800w,/assets/figures/fourier/tissue_before_filtering_mop_all-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/figures/fourier/tissue_before_filtering_mop_all.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <figure slot="second"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_after_lowpass_mop_all-480.webp 480w,/assets/figures/fourier/tissue_after_lowpass_mop_all-800.webp 800w,/assets/figures/fourier/tissue_after_lowpass_mop_all-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/figures/fourier/tissue_after_lowpass_mop_all.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </img-comparison-slider> </div> <figcaption><strong>Figure 1:</strong> Comparison of a gene expression signal before (left) and after (right) low-pass filtering. </figcaption> <p><br></p> <hr> <h2 id="conclusion">Conclusion</h2> <p>How does this formalism enable us to capture regions and interactions? The key is that it provides us with a flexible quantitative framework to represent these features.</p> <p>Take lows for example. It may be intuitive that they help us represent multicellular regions. After all, lows are just large-scale patterns. For instance, we should be able to low-pass filter gene expression patterns and then plug into the standard single-cell workflow to identify region clusters. Indeed, this is the cornerstone of all region identification methods in the field, from those based on simple spatial smoothing to those based on complex graph neural networks.</p> <p>But what are <em>highs</em>? Are they just noise like in image processing? And what of the frequencies in between, i.e. <em>mids</em>? In the following posts, we’ll explore these questions in detail, finding that lows indeed describe multicellular regions, highs describe intercellular interactions, and mids describe boundaries between regions.</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/2025-05-18-graph-fourier.bib"></d-bibliography> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Kamal Maher. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/img-comparison-slider@8.0.6/dist/index.min.js" integrity="sha256-EXHg3x1K4oIWdyohPeKX2ZS++Wxt/FRPH7Nl01nat1o=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/swiper@11.0.5/swiper-element-bundle.min.js" integrity="sha256-BPrwikijIybg9OQC5SYFFqhBjERYOn97tCureFgYH1E=" crossorigin="anonymous"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> </body> </html>