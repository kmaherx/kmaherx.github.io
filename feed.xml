<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="https://kmaherx.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://kmaherx.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2025-06-05T16:10:01+00:00</updated><id>https://kmaherx.github.io/feed.xml</id><title type="html">blank</title><subtitle># A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. </subtitle><entry><title type="html">Spatial Omics II: Defining Multicellular Regions</title><link href="https://kmaherx.github.io/blog/2025/regions/" rel="alternate" type="text/html" title="Spatial Omics II: Defining Multicellular Regions"/><published>2025-05-15T00:00:00+00:00</published><updated>2025-05-15T00:00:00+00:00</updated><id>https://kmaherx.github.io/blog/2025/regions</id><content type="html" xml:base="https://kmaherx.github.io/blog/2025/regions/"><![CDATA[<h2 id="region-components">Region components</h2> <h3 id="large-scale-patterns">Large-scale patterns</h3> <p>As we saw in the <a href="/blog/2025/graph-fourier/">last post</a>, low-pass filtering isolates large-scale patterns. Recall that low-pass filtering corresponds to multiplying our data matrix by a function of the graph Laplacian matrix. Let’s resume this thought by defining our variables so we are all roughly on the same page.</p> <p>Our gene expression is given by the cell-by-gene matrix</p> \[\mathbf{X} \in \mathbb{R}^{c \times g},\] <p>where $c$ is the number of cells and $g$ is the number of genes.</p> <p>One might think that performing conventional single-cell analysis on low-pass filtered data would identify large-scale transcriptional features over the tissue (as opposed to cell type features). In this section, we will show that this is indeed the case.</p> <p>First, we can visualize the result of performing low-pass filtering on a given gene expression signal over the tissue. Consider a marker gene for one of the inner regions of our tissue. Drag the slider left to right to compare the signal before and after filtering.</p> <style>.slider-with-shadows{--default-handle-shadow:0 0 5px rgba(0,0,0,1);--divider-shadow:0 0 5px rgba(0,0,0,0.5)}</style> <div style="width: 50%; max-width: 768px; margin: 0 auto;"> <img-comparison-slider class="slider-with-shadows"> <figure slot="first"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/regions/unfiltered_signal-480.webp 480w,/assets/figures/regions/unfiltered_signal-800.webp 800w,/assets/figures/regions/unfiltered_signal-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/figures/regions/unfiltered_signal.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> <figure slot="second"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/regions/lowpass_signal-480.webp 480w,/assets/figures/regions/lowpass_signal-800.webp 800w,/assets/figures/regions/lowpass_signal-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/figures/regions/lowpass_signal.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </img-comparison-slider> </div> <figcaption><strong>Figure 1:</strong> [Interactive] Comparison of a gene expression signal before (left) and after (right) filtering. </figcaption> <p>Note that the small-scale variation in expression has been washed away. Neighboring cells are forced to look more similar to one another, in effect isolating only <em>large</em>-scale patterns.</p> <h3 id="gene-gene-relationships">Gene-gene relationships</h3> <p>Now that we’ve isolated large-scale gene expression patterns, we can start to compare them to find interesting gene-gene relationships. Intuitively, a group of expression patterns that overlap should represent a region. We can find these groups by looking at pairwise relationships between genes, namely via covariance.</p> <p>Let $\mathbf{\bar X} = [\mathbf{\bar x_1} | … | \mathbf{\bar x_g}] \in \mathbb{R}^{c \times g}$ represent the cell-by-gene matrix of low-pass filtered gene signals. The relationships between all pairs of genes can be represented in terms of covariance. Assuming mean centering, this “low-pass covariance matrix” is given by</p> \[\mathbf{C} = \mathbf{\bar X}^{\top} \mathbf{\bar X} \in \mathbb{R}^{g \times g},\] <p>with entry $\mathbf{C}_{ij} = \mathbf{x_i}^{\top} \mathbf{x_j}$ being the similarity between genes $i$ and $j$. We drop the bar notation for simplicity going forward. Note that, for quantitative simplicity, we do not perform mean centering and find that it rarely impacts the results.</p> <p>We can visualize $\mathbf{C}$ as an image. Gene markers for each region form red blocks along the diagonal, denoting positively covarying groups of genes, i.e. gene programs. Gene programs describing different regions can be seen to negatively correlate, forming blue blocks along the off-diagonal.</p> <p>Ultimately, we seek to distill these patterns of complementary gene programs into a simpler representation – perhaps by assigning each gene a single value. Let $\mathbf{u} \in \mathbb{R}^{c}$ represent this desired representation. If $\mathbf{u}$ is a good representation, it should produce a similar covariance pattern to $\mathbf{C}$. This can be quantified as</p> \[\sum_{ij} \mathbf{C}_{ij} (\mathbf{u}_i \mathbf{u}_j).\] <p>Thus, we wish to find the embedding $\mathbf{u}$ that maximizes this expression.</p> <hr/> <h2 id="gradients">Gradients</h2> <p>The above components indeed appear to contain orthogonal information. They each describe unique sets of regions. Together, however, these features can describe more complex region patterns. Rather than projecting cells onto a single component, one can instead project onto multiple components that form a multidimensional “region space”. For instance, we can project cells onto the space defined by the top three components by calculating</p> \[\mathbf{S} = \mathbf{X} \mathbf{U} \in \mathbb{R}^{c \times 3}\] <p>where $\mathbf{U} = [\mathbf{u}_1 | \mathbf{u}_2 | \mathbf{u}_3]$. Cells can then be plotted in the resulting three-dimensional space Figure.</p> <p>Note that the cells appear to form a one-dimensional manifold. In order to interpret this manifold, one can first fit a line to it and visualize it in tissue space. To fit a line, we first connect neighboring cells in this region space using a weighted Delaunay triangulation. Cells closer to one another have higher weights while those further from one another have lower weights. This provides a \textit{domain} in region space. We can then calculate and eigendecompose the corresponding Laplacian matrix to find the lowest eigenvector which represents the lowest frequency and thus the longest path through the domain. The result is the coloring shown in Figure. Note that this approach is essentially the same as diffusion maps, which is a conventional single-cell trajectory inference method.</p> <iframe src="/assets/plotly/region_gradient.html" frameborder="0" scrolling="yes" height="500px" width="100%" style="border: none; display: block; margin: 0 auto;"></iframe> <p>The resulting coloring reveals a continuous, molecularly defined “depth” axis, as seen when plotted in the tissue. We could alternatively make sense of this manifold given the components plotted in. Component 1 describes an “inside-outside” pattern with only the outermost layer considered outside. Component 2 then splits the inside layers from component 1 in the same way. Finally, component 3 further splits the inside layers from component 2. Thus, together, these features can distinguish each layer, while the inside-outside patterns enable the layers to be related to one another in terms of depth.</p> <figure style="text-align: center;"> <img src="/assets/figures/regions/region_gradient.png" alt="" style="width:50%; display: block; margin: 0 auto;"/> <figcaption><strong>Figure 3:</strong> Molecular gradient visualized in the tissue.</figcaption> </figure> <hr/> <h2 id="clusters">Clusters</h2> <p>Nice.</p>]]></content><author><name>Kamal Maher</name></author><category term="spatial-omics"/><summary type="html"><![CDATA[A principled approach to representing multicellular regions in spatial omics data]]></summary></entry><entry><title type="html">Spatial Omics I: Transcriptional Signals Over Tissue Domains</title><link href="https://kmaherx.github.io/blog/2025/graph-fourier/" rel="alternate" type="text/html" title="Spatial Omics I: Transcriptional Signals Over Tissue Domains"/><published>2025-05-14T00:00:00+00:00</published><updated>2025-05-14T00:00:00+00:00</updated><id>https://kmaherx.github.io/blog/2025/graph-fourier</id><content type="html" xml:base="https://kmaherx.github.io/blog/2025/graph-fourier/"><![CDATA[<style>.slider-with-shadows{--default-handle-shadow:0 0 5px rgba(0,0,0,1);--divider-shadow:0 0 5px rgba(0,0,0,0.5)}</style> <h2 id="introduction">Introduction</h2> <p>Here, we will build an intuition for how to describe frequencies over graphs in terms of gene expression over biological tissues. We’ll assume familiarity with linear algebra. We will use simulations to</p> <h3 id="tissues">Tissues</h3> <p>Cells are important Have different <a href="https://www.cell.com/cell-systems/fulltext/S2405-4712(18)30482-4">roles in the tissue that can largely be described by their molecular patterns</a>. Such “types” catalogued by efforts such as the human cell atlas.</p> <p>But cells don’t act independently. If you look at an organism, you’ll notice a few things. First, it’s an organism; there’s some sense that it’s a discrete collection of cells all working together. Second, you might notice that cells within a given organism are further organized into discrete multicellular structures, such as organs or the anatomical regions within them. Third, and perhaps most importantly, the very formation and function of such structures is driven by interactions between their constituent cells. Altogether, it is critical to look beyond cells in isolation to recognize their</p> <p>We can break these patterns down into two broad categories. Multicellular regions Intercellular interactions</p> <p>Both of these patterns are inherently spatial. Regions Interactions Thus, spatial omics technologies enable us to measure these patterns.</p> <p>Given the importance of this data, we should have a concrete way to quantitatively describe and analyze them. However, the current landscape of computational methods for spatial omics data is deeply fragmented. It largely consists of complicated methods based on graph neural networks and probabilistic models, and it lacks a fundamental basis for relating these approaches or even defining the core features one would like to quantify.</p> <p>In this series of posts, we will derive such a basis. The tools we will use are borrowed from the vast field of signal processing.</p> <h3 id="domains-and-signals">Domains and signals</h3> <p>Sound (Continuous, 1D)</p> <p>Images (discrete, 2D)</p> <p>Graphs? (discrete, but what dimension? will come back to this)</p> <h3 id="signal-processing">Signal processing</h3> <p>Sound (music, bass/mids/treble)</p> <p>Images (denoising by removing highs)</p> <h3 id="overview">Overview</h3> <p>Simulations then real data</p> <p>This isn’t a new idea. Fundamentals of GSP. GNNs based on GSP, just overshadow the basics. But when we thoroughly explore the basics, we can find previously overlooked ideas. This chapter will only cover the basics, with applications covered in future posts.</p> <hr/> <h2 id="simulation">Simulation</h2> <p>We’ll first demonstrate the fundamental concepts in a simple simulation. This will allow us to build up some intuition before approaching data gathered from real tissues, which is full of both technical artifacts and true biological complexity.</p> <h3 id="construction">Construction</h3> <p>Take the brain as inspiration. We’ll start off by creating a simple tissue made up of $n=2000$ cells randomly scattered throughout a unit circle. One should ask why a circle and not a sphere. It’s because, while tissues are 3D objects, we tend to measure them in 2D slices. That being said, everything presented in this series of posts can be generalized to data in arbitrary dimensions, including 3D.</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/tissue_domain_nozoom.png" alt="" style="width:30%; display: block; margin: 0 auto;"/> <figcaption><strong>Figure 1:</strong> Simulation of a simple, circular tissue. </figcaption> </figure> <p>Some spatial cells that form layers (neurons), some non-spatial cells scattered throughout (glia, for the most part).</p> <p>Ground truth region patterns. Add different noise patterns to make multiple gene markers for each ground truth pattern. One marker per pattern shown in Figure &lt;&gt;.</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/simulation_lows.png" alt="" style="width:100%; display: block; margin: 0 auto;"/> <figcaption><strong>Figure 1:</strong> Schematic for simulating multicellular region patterns. </figcaption> </figure> <p>On the other hand, spatial patterns also arise from interactions between cells. For instance, two <em>neighboring</em> cells might interact when <em>one</em> expresses a ligand and <em>the other</em> expresses the corresponding receptor. This would produce a mutually exclusive pattern between two genes: one associated with the ligand and the other associated with the receptor. We can simulate this by</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/simulation_highs.png" alt="" style="width:100%; display: block; margin: 0 auto;"/> <figcaption><strong>Figure 1:</strong> Schematic for simulating intercellular interaction patterns. </figcaption> </figure> <p>Note that this simulation is not nearly as complex as a real biological tissue or the data measured from one. That being said, it should at least provide a simple playground in which we can explore some fundamental quantitative concepts that we will later apply to real data.</p> <p>That being said, let’s start exploring these quantitative fundamentals.</p> <h3 id="the-tissue-domain">The tissue domain</h3> <p>We can think of the tissue domain as an undirected graph over $n$ nodes, each of which represents a cell. We could construct this graph in many ways, including connecting each cell to its k nearest physical neighbors. Personally, I prefer using a Delaunay triangulation, as it creates a mesh that’s embeddable in 2D, which respects my own visual intuition. If you’re optimistic, you might also believe that it <a href="https://pubmed.ncbi.nlm.nih.gov/20082148/">captures the mechanical forces present in biological tissues</a>. After performing a Delaunay triangulation, we can zoom in to see that the cells are indeed connected to their spatial neighbors to form a 2D mesh. These connections define the space within which we can hop from cell to cell.</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/tissue_domain.png" alt="" style="width:50%; display: block; margin: 0 auto;"/> <figcaption><strong>Figure 1:</strong> Cells arranged in a spatial graph to form a tissue domain. </figcaption> </figure> <p>Now let’s define the key mathematical objects associated with this tissue domain. Our graph can be represented by the symmetric adjacency matrix</p> \[\mathbf{A} \in \{0,1\}^{n \times n}.\] <p>Each entry \(\mathbf{A}_{ij}\) is either $1$, which represents two cells that are spatially adjacent, or $0$, which represents two cells that are not adjacent. While we could weight these edges based on physical distances between cells, we will instead stick to simple binary edges for simplicity. We also will not consider self loops: \(\mathbf{A}_{ii} = 0\). The number of neighbors for cell $i$ – the “degree” – is given by \(d_i = \sum_j \mathbf{A}_{ij}\). These values are often consolidated into the diagonal degree matrix</p> \[% \mathbf{D} = \operatorname{diag}(d_1, ..., d_n) = \mathbf{D} = \begin{bmatrix} d_{1} &amp; &amp; \\ &amp; \ddots &amp; \\ &amp; &amp; d_{n} \end{bmatrix} \in \mathbb{R}^{n \times n}.\] <p>Finally, we can introduce the Laplacian matrix</p> \[\mathbf{L} = \mathbf{D} - \mathbf{A}\] <p><strong><em>give intuition</em></strong> For convenience, we will instead consider the edge-normalized Laplacian $\mathbf{L} = \mathbf{I} - \mathbf{D}^{-\frac{1}{2}} \mathbf{A} \mathbf{D}^{-\frac{1}{2}}$, since it’s eigenvalues have some nice properties that we will leverage later.</p> <p>Note that the order of cells in these matrices is arbitrary. It doesn’t matter so long as it is consistent across all related vectors and matrices.</p> <p>Now that we have a simulated tissue domain, we can create gene expression signals over it.</p> <h3 id="transcriptional-signals">Transcriptional signals</h3> <p>A signal is a vector of values associated with each node in our graph. In our case, we are interested in the amount that a given gene is expressed within each cell of a tissue. We can collect all of these values into a list, yielding the vector $\mathbf{x} \in \mathbb{R}^n$, where $\mathbf{x}_i$ is the amount of gene $x$ expressed in cell $i$. We can further collect all of these gene signals into the matrix</p> \[\mathbf{X} = [\mathbf{x}_1 | ... | \mathbf{x}_g] \in \mathbb{R}^{n \times g},\] <p>where $g$ is the number of genes measured. This is the “cell-by-gene matrix”, the <a href="https://cellxgene.cziscience.com/">fundamental data structure underlying all of single-cell omics</a>.</p> <p>Now that we’ve quantitatively defined both our domain and our signals, our challenge is to combine them.</p> <h3 id="frequencies">Frequencies</h3> <p>While it’s often said that spatial data offers more information than dissociated single-cell data, we might be better served by the intuition that spatial coordinates enable us to strategically <em>remove</em> information. Namely, it allows us to focus on gene expression over particular length scales of interest, disentangling the mess of information into more interpretable components. But how can we isolate a given length scale? The first step is defining what a length scale is in the first place.</p> <p>Take music for instance, in which the different frequency ranges of bass, mids, and trebles define different <em>time</em> scales along which a sound can vary. Similarly, our notion of <em>length</em> scale can be made quantitatively rigorous in terms of <em>spatial</em> frequencies. While a straightforward extension of this concept to two dimensions captures spatial frequencies in an image, it’s not so straightforward to extend to graphs due to their irregular topology. Thus, we have to do a little leg work to extend this concept to our tissue domain.</p> <p>We can start by slowly deriving a definition of frequency in a graph setting. Consider a hypothetical signal $\mathbf{v}$ over the tissue. The notion of frequency is simply “how much does the signal tend to change as I take a step in the domain?” Taking a step in our tissue domain corresponds to moving between neighboring cells $i$ and $j$. The change in our signal as we take this step is thus given by $\mathbf{v}_i - \mathbf{v}_j$. However, we don’t really care about the sign, so we can just square it to get $(\mathbf{v}_i - \mathbf{v}_j)^2$. This is just one step, and we care about how the signal tends to change with steps throughout the whole tissue in general. To capture this tendency, we can simply sum over all pairs of neighboring cells, yielding our final definition of frequency</p> <p>\begin{equation} \label{eq:freqdef} \lambda = \sum_{ij} \mathbf{A}_{ij} (\mathbf{v}_i - \mathbf{v}_j)^2 \end{equation}</p> <p>Note that because we are summing over <em>all</em> possible pairs of cells $i$ and $j$, we have to multiply each one by $\mathbf{A}_{ij}$ so that we only consider <em>neighboring</em> pairs.</p> <p>This definition of frequency might make sense, but what we are really looking for is an ideal set of <em>all possible frequencies</em>, much as time scales are given by sine waves of all possible frequencies. It turns out that, because our tissue domain is finite and discrete, we can actually solve for a finite set of all possible frequencies, and it turns out to be a basis in the linear algebraic sense.</p> <p>First, we can rewrite eq. \eqref{eq:freqdef} as a “<a href="https://gregorygundersen.com/blog/2022/02/27/positive-definite/">quadratic form</a>”, which works in our favor by getting us a step further into the realm of linear algebra:</p> \[\lambda = \mathbf{v}^{\top} \mathbf{L} \mathbf{v}.\] <details><summary>How do we derive that?</summary> <p>Eq. \eqref{eq:freqdef} can be converted into a quadratic form via a process reminiscent of annealing. First, we heat it up by factoring the $\mathbf{v}$ terms to get</p> \[\sum_{i,j}\mathbf{A}_{ij}( v_i v_i + v_j v_j - v_i v_j - v_j v_i ).\] <p>We can then begin to cool it down by combining positive and negative terms, respectively, yielding</p> \[2 \sum_{i,j}\mathbf{A}_{ij} v_i v_i - 2 \sum_{i,j}\mathbf{A}_{ij} v_i v_j.\] <p>Note that, for a fixed row $i$, the left-hand term corresponds to summing $v_i v_i$ together $d_i$ times, where $d_i$ is the sum of the $i$th row of $\mathbf{A}$. Thus, one could equivalently express the left-hand term as</p> \[2 \sum_{i}\mathbf{D}_{ii} v_i v_i.\] <p>Now both the left and right terms themselves correspond to quadratic forms, yielding</p> \[2 \mathbf{v}^{\top} \mathbf{D} \mathbf{v} - 2 \mathbf{v}^{\top} \mathbf{A} \mathbf{v}.\] <p>Further simplifying, we have</p> \[2 \mathbf{v}^{\top} (\mathbf{D}-\mathbf{A}) \mathbf{v}\] <p>and further</p> \[2 \mathbf{v}^{\top} \mathbf{L} \mathbf{v}.\] <p>The factor of two arises from double counting each edge, which corresponds to a directed edge in each direction. Because we tend to think of each undirected edge as only a single edge going both ways, folks tend to omit this factor, yielding the final expression</p> \[\mathbf{v}^{\top} \mathbf{L} \mathbf{v}.\] </details> <p>Next, we should normalize by the magnitude of $\mathbf{v}$ to guarantee that the overall expression strength doesn’t matter. After all, we really only care about the relative spatial distribution of the signal, not its overall magnitude. We can do that by modifying the equation to get</p> \[\lambda = \frac{\mathbf{v}^{\top} \mathbf{L} \mathbf{v}}{\mathbf{v}^{\top} \mathbf{v}}.\] <p>Finally, it turns out we can actually rearrange this expression to get an eigenvalue problem:</p> \[\begin{align} &amp; \lambda = {\frac{\mathbf{v}^{\top} \mathbf{L} \mathbf{v}}{\mathbf{v}^{\top} \mathbf{v}}} \nonumber \\ &amp;\rightarrow \lambda \mathbf{v}^{\top} \mathbf{v} = \mathbf{v}^{\top} \mathbf{L} \mathbf{v} \\ &amp;\rightarrow \lambda \mathbf{v} = \mathbf{L} \mathbf{v}. \nonumber \end{align}\] <p>This is a critical insight because $\mathbf{L}$ is symmetric positive semidefinite and thus has an eigenbasis of eigenvectors with real, nonnegative eigenvalues. This eigenbasis is given by the matrix</p> \[\mathbf{V} = [\mathbf{v}_1 |...| \mathbf{v}_n] \in \mathbb{R}^{n \times n}.\] <p>Plugging all of this terminology into our context of interest, we find that there exists a finite set of ideal signals ${\mathbf{v}_1, …, \mathbf{v}_n}$ that represent “all possible frequencies” – and thus all possible length scales – over our tissue domain. After visualizing a few of these frequencies, we can see that they indeed appear to represent abstract notions of variation across different scales in our tissue.</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/frequencies.png" alt="" style="width:100%; display: block; margin: 0 auto;"/> <figcaption><strong>Figure 3:</strong> Examples of different frequencies over the tissue domain. </figcaption> </figure> <details><summary>Why do highs appear constrained to one part of the tissue?</summary> <p>When taking a look at $\mathbf{v}_{300} $ , the fluctuations appear constrained to the lower left portion of the tissue. Uncertainty principle How I see it: consequence of “irregular” topology If all cells had the same degree: But because they don’t, we have:</p> </details> <p>Now that we’ve derived a concrete notion of length scale, we can use it to describe the spatial properties of gene expression patterns.</p> <h3 id="spectra">Spectra</h3> <figure style="text-align: center;"> <img src="/assets/figures/fourier/spectra.png" alt="" style="width:100%; display: block; margin: 0 auto;"/> <figcaption><strong>Figure 3:</strong> An example gene expression signal in tissue space and in frequency space. </figcaption> </figure> <h3 id="filtering">Filtering</h3> <p>We perform filtering in frequency space by applying a kernel.</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/lowpass_spectra.png" alt="" style="width:100%; display: block; margin: 0 auto;"/> <figcaption><strong>Figure 3:</strong> A gene expression signal low-pass filtered in frequency space. </figcaption> </figure> <p>We then put the resulting spectrum back into the tissue to visualize the result. Use the slider to visualize before (left) and after (right) filtering.</p> <div style="width: 50%; max-width: 768px; margin: 0 auto;"> <img-comparison-slider class="slider-with-shadows"> <figure slot="first"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_before_filtering-480.webp 480w,/assets/figures/fourier/tissue_before_filtering-800.webp 800w,/assets/figures/fourier/tissue_before_filtering-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/figures/fourier/tissue_before_filtering.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> <figure slot="second"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_after_lowpass-480.webp 480w,/assets/figures/fourier/tissue_after_lowpass-800.webp 800w,/assets/figures/fourier/tissue_after_lowpass-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/figures/fourier/tissue_after_lowpass.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </img-comparison-slider> </div> <figcaption><strong>Figure 1:</strong> Comparison of a gene expression signal before (left) and after (right) low-pass filtering. </figcaption> <p><br/></p> <p>Looks smoother. Image literature -&gt; denoising?</p> <p>Alternatively, we could emphasize the highs by applying a square-root filter.</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/highpass_spectra.png" alt="" style="width:100%; display: block; margin: 0 auto;"/> <figcaption><strong>Figure 3:</strong> A gene expression signal high-pass filtered in frequency space. </figcaption> </figure> <p>Rather than grouping neighboring cells together, this filter appears to emphasize their differences.</p> <div style="width: 50%; max-width: 768px; margin: 0 auto;"> <img-comparison-slider class="slider-with-shadows"> <figure slot="first"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_before_filtering-480.webp 480w,/assets/figures/fourier/tissue_before_filtering-800.webp 800w,/assets/figures/fourier/tissue_before_filtering-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/figures/fourier/tissue_before_filtering.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> <figure slot="second"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_after_highpass-480.webp 480w,/assets/figures/fourier/tissue_after_highpass-800.webp 800w,/assets/figures/fourier/tissue_after_highpass-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/figures/fourier/tissue_after_highpass.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </img-comparison-slider> </div> <figcaption><strong>Figure 1:</strong> Comparison of a gene expression signal before (left) and after (right) high-pass filtering. </figcaption> <p><br/></p> <p>Note that these particular kernels were chosen because they each have biological significance that will be explained in future blog posts.</p> <hr/> <h2 id="real-data">Real data</h2> <p>Next, we’ll use <a href="https://www.nature.com/articles/s41586-021-03705-x">real data from the mouse brain</a>.</p> <h3 id="frequencies-1">Frequencies</h3> <p>First, the domain</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/tissue_domain_mop.png" alt="" style="width:70%; display: block; margin: 0 auto;"/> <figcaption><strong>Figure 3:</strong> A tissue domain calculated from real mouse brain data. </figcaption> </figure> <p>Then the frequencies</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/frequencies_mop.png" alt="" style="width:100%; display: block; margin: 0 auto;"/> <figcaption><strong>Figure 3:</strong> Example frequencies over the mouse brain tissue domain. </figcaption> </figure> <p>Then the spectrum of <em>Cux2</em>, a neocortical layer marker gene.</p> <figure style="text-align: center;"> <img src="/assets/figures/fourier/spectra_mop.png" alt="" style="width:100%; display: block; margin: 0 auto;"/> <figcaption><strong>Figure 3:</strong> An example gene expression signal in tissue space and in frequency space. </figcaption> </figure> <h3 id="filtering-1">Filtering</h3> <p>First, low-pass</p> <div style="width: 50%; max-width: 768px; margin: 0 auto;"> <img-comparison-slider class="slider-with-shadows"> <figure slot="first"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_before_filtering_mop-480.webp 480w,/assets/figures/fourier/tissue_before_filtering_mop-800.webp 800w,/assets/figures/fourier/tissue_before_filtering_mop-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/figures/fourier/tissue_before_filtering_mop.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> <figure slot="second"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_after_lowpass_mop-480.webp 480w,/assets/figures/fourier/tissue_after_lowpass_mop-800.webp 800w,/assets/figures/fourier/tissue_after_lowpass_mop-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/figures/fourier/tissue_after_lowpass_mop.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </img-comparison-slider> </div> <figcaption><strong>Figure 1:</strong> Comparison of a gene expression signal before (left) and after (right) low-pass filtering. </figcaption> <p><br/></p> <p>Then high-pass</p> <div style="width: 50%; max-width: 768px; margin: 0 auto;"> <img-comparison-slider class="slider-with-shadows"> <figure slot="first"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_before_filtering_mop-480.webp 480w,/assets/figures/fourier/tissue_before_filtering_mop-800.webp 800w,/assets/figures/fourier/tissue_before_filtering_mop-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/figures/fourier/tissue_before_filtering_mop.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> <figure slot="second"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_after_highpass_mop-480.webp 480w,/assets/figures/fourier/tissue_after_highpass_mop-800.webp 800w,/assets/figures/fourier/tissue_after_highpass_mop-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/figures/fourier/tissue_after_highpass_mop.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </img-comparison-slider> </div> <figcaption><strong>Figure 1:</strong> Comparison of a gene expression signal before (left) and after (right) high-pass filtering. </figcaption> <p><br/></p> <h3 id="multiple-samples">Multiple samples</h3> <p>Now on multiple slices. The exact values differ based on the exact graph structure, but the meaning of the values is shared. Lower values indicate lower frequencies, etc. The distribution of frequency values for a given graph really just reflects the degree distribution. Because cells are largely uniformly scattered throughout a given slice, these distributions are similar across slices. Thus, we can compare frequencies across samples, and the meaning of a given kernel is conserved. One could come up with ways to overcome the difference in dimensions to compare spectral patterns across datasets, but that’s a topic we’ll leave for another post.</p> <p>In parallel Approximation, PyGSP, Hammond</p> <p>To keep things brief, we’ll just look at the low-pass results.</p> <div style="width: 100%; max-width: 768px; margin: 0 auto;"> <img-comparison-slider class="slider-with-shadows"> <figure slot="first"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_before_filtering_mop_all-480.webp 480w,/assets/figures/fourier/tissue_before_filtering_mop_all-800.webp 800w,/assets/figures/fourier/tissue_before_filtering_mop_all-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/figures/fourier/tissue_before_filtering_mop_all.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> <figure slot="second"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/fourier/tissue_after_lowpass_mop_all-480.webp 480w,/assets/figures/fourier/tissue_after_lowpass_mop_all-800.webp 800w,/assets/figures/fourier/tissue_after_lowpass_mop_all-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/figures/fourier/tissue_after_lowpass_mop_all.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </img-comparison-slider> </div> <figcaption><strong>Figure 1:</strong> Comparison of a gene expression signal before (left) and after (right) low-pass filtering. </figcaption> <p><br/></p> <hr/> <h2 id="conclusion">Conclusion</h2> <p>How does this formalism enable us to capture regions and interactions? The key is that it provides us with a flexible quantitative framework to represent these features.</p> <p>Take lows for example. It may be intuitive that they help us represent multicellular regions. After all, lows are just large-scale patterns. For instance, we should be able to low-pass filter gene expression patterns and then plug into the standard single-cell workflow to identify region clusters. Indeed, this is the cornerstone of all region identification methods in the field, from those based on simple spatial smoothing to those based on complex graph neural networks.</p> <p>But what are <em>highs</em>? Are they just noise like in image processing? And what of the frequencies in between, i.e. <em>mids</em>? In the following posts, we’ll explore these questions in detail, finding that lows indeed describe multicellular regions, highs describe intercellular interactions, and mids describe boundaries between regions.</p>]]></content><author><name>Kamal Maher</name></author><category term="spatial-omics"/><summary type="html"><![CDATA[An introduction to graph signal processing in spatial omics data]]></summary></entry></feed>