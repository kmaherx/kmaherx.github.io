<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Spatial Omics II: Defining Multicellular Regions | Kamal Maher </title> <meta name="author" content="Kamal Maher"> <meta name="description" content="A principled approach to representing multicellular regions in spatial omics data"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%AB%A7&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://kmaherx.github.io/blog/2025/regions/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/img-comparison-slider@8.0.6/dist/styles.min.css" integrity="sha256-3qTIuuUWIFnnU3LpQMjqiXc0p09rvd0dmj+WkpQXSR8=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11.0.5/swiper-bundle.min.css" integrity="sha256-yUoNxsvX+Vo8Trj3lZ/Y5ZBf8HlBFsB6Xwm7rH75/9E=" crossorigin="anonymous"> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Spatial Omics II: Defining Multicellular Regions",
            "description": "A principled approach to representing multicellular regions in spatial omics data",
            "published": "May 15, 2025",
            "authors": [
              
              {
                "author": "Kamal Maher",
                "authorURL": "",
                "affiliations": [
                  {
                    "name": "MIT, Broad Institute",
                    "url": ""
                  }
                ]
              }
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Kamal</span> Maher </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Spatial Omics II: Defining Multicellular Regions</h1> <p>A principled approach to representing multicellular regions in spatial omics data</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#region-components">Region components</a> </div> <div> <a href="#gradients">Gradients</a> </div> <div> <a href="#clusters">Clusters</a> </div> </nav> </d-contents> <h2 id="region-components">Region components</h2> <h3 id="large-scale-patterns">Large-scale patterns</h3> <p>As we saw in the <a href="/blog/2025/graph-fourier/">last post</a>, low-pass filtering isolates large-scale patterns. Recall that low-pass filtering corresponds to multiplying our data matrix by a function of the graph Laplacian matrix. Let’s resume this thought by defining our variables so we are all roughly on the same page.</p> <p>Our gene expression is given by the cell-by-gene matrix</p> \[\mathbf{X} \in \mathbb{R}^{c \times g},\] <p>where $c$ is the number of cells and $g$ is the number of genes.</p> <p>One might think that performing conventional single-cell analysis on low-pass filtered data would identify large-scale transcriptional features over the tissue (as opposed to cell type features). In this section, we will show that this is indeed the case.</p> <p>First, we can visualize the result of performing low-pass filtering on a given gene expression signal over the tissue. Consider a marker gene for one of the inner regions of our tissue. Drag the slider left to right to compare the signal before and after filtering.</p> <style>.slider-with-shadows{--default-handle-shadow:0 0 5px rgba(0,0,0,1);--divider-shadow:0 0 5px rgba(0,0,0,0.5)}</style> <div style="width: 50%; max-width: 768px; margin: 0 auto;"> <img-comparison-slider class="slider-with-shadows"> <figure slot="first"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/regions/unfiltered_signal-480.webp 480w,/assets/figures/regions/unfiltered_signal-800.webp 800w,/assets/figures/regions/unfiltered_signal-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/figures/regions/unfiltered_signal.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <figure slot="second"> <picture> <source class="responsive-img-srcset" srcset="/assets/figures/regions/lowpass_signal-480.webp 480w,/assets/figures/regions/lowpass_signal-800.webp 800w,/assets/figures/regions/lowpass_signal-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/figures/regions/lowpass_signal.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </img-comparison-slider> </div> <figcaption><strong>Figure 1:</strong> [Interactive] Comparison of a gene expression signal before (left) and after (right) filtering. </figcaption> <p>Note that the small-scale variation in expression has been washed away. Neighboring cells are forced to look more similar to one another, in effect isolating only <em>large</em>-scale patterns.</p> <h3 id="gene-gene-relationships">Gene-gene relationships</h3> <p>Now that we’ve isolated large-scale gene expression patterns, we can start to compare them to find interesting gene-gene relationships. Intuitively, a group of expression patterns that overlap should represent a region. We can find these groups by looking at pairwise relationships between genes, namely via covariance.</p> <p>Let $\mathbf{\bar X} = [\mathbf{\bar x_1} | … | \mathbf{\bar x_g}] \in \mathbb{R}^{c \times g}$ represent the cell-by-gene matrix of low-pass filtered gene signals. The relationships between all pairs of genes can be represented in terms of covariance. Assuming mean centering, this “low-pass covariance matrix” is given by</p> \[\mathbf{C} = \mathbf{\bar X}^{\top} \mathbf{\bar X} \in \mathbb{R}^{g \times g},\] <p>with entry $\mathbf{C}_{ij} = \mathbf{x_i}^{\top} \mathbf{x_j}$ being the similarity between genes $i$ and $j$. We drop the bar notation for simplicity going forward. Note that, for quantitative simplicity, we do not perform mean centering and find that it rarely impacts the results.</p> <p>We can visualize $\mathbf{C}$ as an image. Gene markers for each region form red blocks along the diagonal, denoting positively covarying groups of genes, i.e. gene programs. Gene programs describing different regions can be seen to negatively correlate, forming blue blocks along the off-diagonal.</p> <p>Ultimately, we seek to distill these patterns of complementary gene programs into a simpler representation – perhaps by assigning each gene a single value. Let $\mathbf{u} \in \mathbb{R}^{c}$ represent this desired representation. If $\mathbf{u}$ is a good representation, it should produce a similar covariance pattern to $\mathbf{C}$. This can be quantified as</p> \[\sum_{ij} \mathbf{C}_{ij} (\mathbf{u}_i \mathbf{u}_j).\] <p>Thus, we wish to find the embedding $\mathbf{u}$ that maximizes this expression.</p> <hr> <h2 id="gradients">Gradients</h2> <p>The above components indeed appear to contain orthogonal information. They each describe unique sets of regions. Together, however, these features can describe more complex region patterns. Rather than projecting cells onto a single component, one can instead project onto multiple components that form a multidimensional “region space”. For instance, we can project cells onto the space defined by the top three components by calculating</p> \[\mathbf{S} = \mathbf{X} \mathbf{U} \in \mathbb{R}^{c \times 3}\] <p>where $\mathbf{U} = [\mathbf{u}_1 | \mathbf{u}_2 | \mathbf{u}_3]$. Cells can then be plotted in the resulting three-dimensional space Figure.</p> <p>Note that the cells appear to form a one-dimensional manifold. In order to interpret this manifold, one can first fit a line to it and visualize it in tissue space. To fit a line, we first connect neighboring cells in this region space using a weighted Delaunay triangulation. Cells closer to one another have higher weights while those further from one another have lower weights. This provides a \textit{domain} in region space. We can then calculate and eigendecompose the corresponding Laplacian matrix to find the lowest eigenvector which represents the lowest frequency and thus the longest path through the domain. The result is the coloring shown in Figure. Note that this approach is essentially the same as diffusion maps, which is a conventional single-cell trajectory inference method.</p> <iframe src="/assets/plotly/region_gradient.html" frameborder="0" scrolling="yes" height="500px" width="100%" style="border: none; display: block; margin: 0 auto;"></iframe> <p>The resulting coloring reveals a continuous, molecularly defined “depth” axis, as seen when plotted in the tissue. We could alternatively make sense of this manifold given the components plotted in. Component 1 describes an “inside-outside” pattern with only the outermost layer considered outside. Component 2 then splits the inside layers from component 1 in the same way. Finally, component 3 further splits the inside layers from component 2. Thus, together, these features can distinguish each layer, while the inside-outside patterns enable the layers to be related to one another in terms of depth.</p> <figure style="text-align: center;"> <img src="/assets/figures/regions/region_gradient.png" alt="" style="width:50%; display: block; margin: 0 auto;"> <figcaption><strong>Figure 3:</strong> Molecular gradient visualized in the tissue.</figcaption> </figure> <hr> <h2 id="clusters">Clusters</h2> <p>Nice.</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/2025-05-18-regions.bib"></d-bibliography> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Kamal Maher. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/img-comparison-slider@8.0.6/dist/index.min.js" integrity="sha256-EXHg3x1K4oIWdyohPeKX2ZS++Wxt/FRPH7Nl01nat1o=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/swiper@11.0.5/swiper-element-bundle.min.js" integrity="sha256-BPrwikijIybg9OQC5SYFFqhBjERYOn97tCureFgYH1E=" crossorigin="anonymous"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> </body> </html>